# 챕터1: 리팩터링: 첫 번째 예시

**대규모 시스템의 소스코드는 리팩터링을 하고 안하고의 차이가 큽니다. 그렇기 때문에 이번 장에서 첨부된 리팩토링 과정을 잘 학습해놓아야 합니다.**

## 예시 프로그램 작성 및 소감

> 예시 프로그램은 `example` 디렉토리에 첨부되어 있습니다.

> [!IMPORTANT]
>
> 프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가합니다.

## 리팩터링의 첫 단계

**리팩터링의 첫 단계는 항상 리팩터링할 코드 영역을 꼼꼼하게 검사하는 `테스트 코드`를 마련해야 합니다**. 실제 작업을 사람이 수행하기 때문에 오류가 발생할 가능성이 있는데 이를 테스트 코드를 통해 커버합니다.

만약 해당 예제에서 테스트 코드를 작성한다면 시나리오는 아래와 같을 겁니다.

> [!NOTE]
>
> - statement 함수는 문자열을 반환하기 때문에 다양한 장르의 공연들로 구성된 공연료 청구서 몇 개를 미리 작성해서 문자열 형태로 구성합니다.
> - statement 함수가 반환한 문자열 결과와 준비해둔 정답 문자열을 비교합니다.
> - 테스트 프레임워크를 사용해서 모든 테스트를 단축키 하나로 실행할 수 있도록 설정합니다.

## statement 함수 쪼개기

> [!IMPORTANT]
>
> - 항상 수정을 하면 컴파일하고 테스트해서 실수한게 없는지 확인해야 합니다.
> - 간단한 수정이라도 리팩터링 후에는 테스트하는 습관을 들이는 것이 바람직합니다.

### (1) switch 문 쪼개기

- switch문은 현재 한 번의 공연에 대한 요금을 계산하고 있습니다.
- `함수 추출하기`: 함수를 하나 구성해서 사용하는 방식으로 리팩터링을 진행합니다.
- 별도 함수로 뺐을 때 유효범위를 벗어나는 변수, 즉 새 함수에서는 곧바로 상요할 수 없는 변수가 있는지 확인해야 합니다. 여기서는 `perf, play, thisAmount`가 속합니다.
- `perf`와 `play`는 변하는 값이 아니기 때문에 매개변수로 전달합니다.
- 이와 다르게 `thisAmount`는 특정 로직에 따라 값이 변경되기 때문에 조심해서 다루면 됩니다.
- `중첩함수(Nested Function)`를 사용해서 만들 수도 있다. 중첩 함수를 만들면 할일 하나가 줄어드는 셈이다.
  - 다만, `2-2.js`에서와 같이 for문 안에서 선언된 변수여서 중첩함수가 접근할 수 없습니다.
  - 이렇게 되면 중첩함수를 사용하거나 안하거나 차이점이 없습니다.

### (2) 추출한 함수 내 변수명 변경

- `thisAmount` 변수명을 `result`로 변경합니다.
- 저자는 함수의 반환 값에는 항상 `result` 라는 이름을 쓴다고 합니다. 그렇게 하면 변수의 역할을 쉽게 알 수 있기 때문이라고 합니다.
- 이렇게 하면 함수 내에서 변수의 역할을 쉽게 알 수 있습니다.
- **`amountFor` 함수의 인수인 `perf`를 `aPerformance`로 변경한다고 책에서 말하는데, 이는 `TypeScript`를 활용하면 될 것 같다고 생각합니다.**
  - 접두사 `a/an`는 부정관사라고 하는데 매개변수의 역할(타입)이 뚜렷하지 않을 때 붙입니다.
- **좋은 코드는 하는 일이 명확히 드러나야 하는데 변수 이름은 커다란 역할을 합니다.**

### (3) play 변수 제거하기 -> 임시 변수를 질의 함수로 바뀌기

> [!TIP]
>
> - 변수 인라인 기법을 사용해서 지역변수를 제거하는 것이 과연 긍정적인 영향을 주는걸까?
> - 현재 예제와 같이 지역변수를 다 제거하고 해당 부분을 함수 호출로 대체했는데, 만약 호출하는 함수 쪽에 변화가 생기게 되면 어떻게 되는걸까?
> - 호출하는 함수쪽에 모두 수정을 해야하는데 지역변수를 사용하면 관리포인트가 1개로 줄어드는데 그게 효율적인 것이 아닐지?

- 임시 변수들로 인해서 로컬 범위에 존재하는 이름이 늘어나서 추출 작업이 어려울 수 있습니다.
- 이러한 점을 해소하기 위해서는 변수 인라인하는 기법을 사용해서 갈등을 해소합니다.

### (4) 이름 짓기

- 이름짓기는 중요하지만 쉽지 않은 작업입니다.
- 긴 함수를 작게 쪼개는 리팩터링은 이름을 잘 지어야만 효과가 있습니다.
- 이름이 좋으면 함수 본문을 읽지 않고도 무슨 일을 하는지 알 수 있습니다.