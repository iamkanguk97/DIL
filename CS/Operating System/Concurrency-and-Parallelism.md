# 동시성(Concurrency)과 병렬성(Parallelism)

## 요약

| 동시성(Concurrency)                         | 병렬성(Parallelism)                         |
| ------------------------------------------- | ------------------------------------------- |
| 동시에 실행되는 것 같이 보이는 것           | 실제로 동시에 여러 작업이 처리되는 것       |
| 싱글 코어에서 멀티 쓰레드를 동작시키는 방식 | 멀티 코어에서 멀티 쓰레드를 동작시키는 방식 |
| 한번에 많은 것을 처리                       | 한번에 많은 일을 처리                       |
| 논리적 개념                                 | 물리적 개념                                 |

> ![IMPORTANT]
>
> 동시성은 많은 일을 동시에 **다루는** 것이고, 병렬성은 많은 일을 동시에 **수행하는** 것이라고 이해합니다.

## 병렬성(Parallelism)

> ![NOTE]
>
> -   **어떠한 작업이 하위작업으로 나뉘어 물리적으로 동시에 처리가 되는 일**
> -   대표적인 예로는 행렬 곱셈과 Monoid가 있습니다.

`3x3` 행렬끼리 곱해야 하는 작업이 있다고 가정해봅시다. 만약에 연산 결과의 각 요소를 순차적으로 계산해야 한다면, 총 27번의 연산이 필요합니다.<br/>
하지만, 각 위치의 결과를 한 번에 계산한다면 단 3번의 연산만으로도 계산이 가능합니다.

그리고, 실제로 `1+2+3+4+5+6+7+8` 이라는 식이 있다고 한다면, 두덩어리씩 짝지어 계산을 할 수 있습니다.<br/>
(컴퓨터는 3덩이씩 나눠서 계산하는게 안되기 때문)

```
1+2+3+4+5+6+7+8
=> (1+2)+(3+4)+(5+6)+(7+8)
=> (3+7)+(11+15)
=> 10+26
=> 36
```

위와 같이 계산이 된다면 3번의 계산으로 원하는 결과를 얻어낼 수 있습니다.<br/>
만약 순차적으로 계산을 했다고 한다면 더욱 많은 계산 횟수가 발생했을 것입니다.

## 동시성(Concurrency)

> ![NOTE]
>
> -   병렬성은 하나의 문제를 풀기 위해 여러 작업을 동시에 수행하는 것입니다.
> -   **하지만 동시성은 여러 작업을 동시에 수행하는 것 그 자체, 또는 동시에 수행되는 것처럼 보여지는 것을 의미합니다.**
> -   대표적인 예로는 웹서버가 여러 요청을 동시에 처리하는 것입니다.

하나의 코어(CPU)는 요청을 하나씩 처리하는 것이 아닌 여러 개의 요청을 짧은 시간 단위로 번갈아가며 실행하는 시간 분할(Time-Sharing) 또는 컨텍스트 스위칭(Context-Switching) 방식을 통해 구현됩니다.<br/>
예를 들어, 웹 브라우저에서 여러 탭을 열어두고 사용한다고 가정해보면, 실제로는 CPU가 각 탭의 작업을 아주 빠르게 전환하며 처리하기 때문에 사용자 입장에서는 여러 탭이 동시에 작동하는 것처럼 느껴지는 겁니다.

이처럼 실제로 동시에 수행되는것과 관계 없이 각 작업 전체를 순차적으로 처리하는 것이 아닌 여러 방법에 따라 동시에 수행하는 것을 `동시성(Concurrency)`이라고 합니다.

## 단일 코어, 단일 스레드에서는 동시성이 발생하지 않을까요?

결론부터 말하면 진정한 의미의 동시성이 발생하기는 어렵지만 예외적인 상황이나 특정 관점에서는 동시성의 개념을 적용할 수 있습니다.

### 진정한 의미의 동시성: 여러 작업의 시간 분할

> -   위의 내용과 동일하게 동시성은 여러 작업이 동시에 진행되는 것처럼 보이는 것을 의미합니다.
> -   이는 주로 운영체제의 스케줄러가 여러 프로세스나 스레드를 매우 빠른 속도로 번갈아 가면서 실행하며 달성됩니다.

`단일 코어 + 다중 스레드/프로세스`인 경우, 하나의 CPU 코어가 여러 스레드나 프로세스 사이를 빠르게 전환하면서 실행될 겁니다. 대표적인 예가 다중 탭입니다.<br/>
사용자 입장에서는 웹 브라우저에서 여러 탭을 열어두거나 워드 프로세서와 음악 플레이어를 동시에 사용하는 것처럼 느껴지지만 실제로는 완전 동시에 일어나는 것이 아니라는 것입니다.<br/>
이것이 동시성의 일반적인 예시입니다. CPU는 타임 슬라이싱을 통해 각 작업을 짧은 시간동안만 처리하고 다른 작업으로 전환하여 모든 작업이 진행되는 것처럼 보이게 하는 것입니다.

`단일 코어 + 단일 스레드/프로세스`인 경우 동시에 번갈아 가며 처리할 다른 작업이 없습니다. 하나의 작업이 시작되면 그 작업이 완료될 때까지 다른 어떤 작업도 CPU를 사용할 수 없습니다.<br/>
그래서 여러 작업이 동시에 진행되는 것처럼 보이는 효과 자체가 발생하기는 어렵습니다.

### 예외 사항: 비동기 I/O (Asynchronous I/O)

> -   단일 코어, 단일 스레드 환경에서도 동시성이라는 용어를 사용하게 만드는 개념이 대표적으로 비동기입니다.
> -   Node.js 환경이 대표적입니다.

> ![IMPORTANT]
>
> -   **일반적인 I/O 작업(파일 읽기, 네트워크 요청, 사용자 입력 등)은 CPU가 관여하지 않고 오랜 시간이 걸리는 경우가 많습니다. 이를 단일 스레드에서 동기적으로 처리를 하게 되면 I/O 작업이 완료될 때까지 해당 스레드는 아무것도 하지 않고 대기를 하게 됩니다. 대기 시간동안 CPU는 유휴상태가 됩니다.**
>
> -   **하지만 비동기적으로 처리하게 되면 I/O 작업을 백그라운드에서 수행시키고 해당 스레드는 대기하지 않고 바로 다른 작업을 수행할 수 있도록 합니다. 따라서, I/O 작업이 백그라운드에서 진행되는 동안 CPU는 다른 계산을 하거나 다른 요청을 처리할 수 있습니다. 이후 I/O 작업이 완료되면 시스템이 스레드에 알림을 주고 스레드는 콜백 함수를 통해 결과를 처리합니다.**
>
> -   **대표적으로는 `Node.js`가 있습니다. 기본적으로 단일 스레드(메인 이벤트 루프)로 동작하지만 비동기 I/O를 적극적으로 활용해서 많은 수의 네트워크 요청을 동시성있게 처리할 수 있습니다. 다시 말해, 하나의 웹 서버가 수백, 수천 개의 동시 접속을 단일 스레드로 처리하는 것이 가능한데 이는 I/O 대기시간 동안 CPU를 효율적으로 활용하기 때문입니다.**

### 결론

-   물리적으로 여러 작업을 동시에 실행하는 병렬성은 단일 코어, 단일 스레드에서는 불가능하다.
-   여러 작업을 동시에 처리하는 것처럼 보이는 동시성 역시 CPU 바운드 작업만 있다면 단일 코어 단일 스레드에서는 발생하기 어렵습니다. 왜냐하면 번갈아 가며 처리할 다른 스레드나 프로세스가 없기 때문입니다.
-   하지만 I/O 바운드 작업이 많다면 비동기 I/O를 통해 단일 코어 스레드에서도 동시적인 처리가 가능합니다.

---

## References

-   [[번역] 동시성,병렬성,그리고 자바스크립트에 대한 이해](https://velog.io/@surim014/concurrency-and-parallelism)
-   [백엔드 개발자들이 알아야할 동시성1 - Concurrency와 Parallelism](https://choi-geonu.medium.com/%EB%B0%B1%EC%97%94%EB%93%9C-%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%93%A4%EC%9D%B4-%EC%95%8C%EC%95%84%EC%95%BC%ED%95%A0-%EB%8F%99%EC%8B%9C%EC%84%B1-1-concurrency%EC%99%80-parallelism-88c51aa2cdc5)
